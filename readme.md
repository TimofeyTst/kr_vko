Алгоритм работы
Каждый из сервисов проверяет условия запуска, упомянутые в общих задачах: не root пользователь, Linux, bash

kp:
- При запуске удаляется старая база vkr.db, создаётся новая с таблицами (targets, services, ammo, detections, shots) и триггерами для автоматического обновления временных меток при изменении записей.
- Каждые N секунд происходит пинг сервисов в фоне: Если понга нет — сервис считается недоступным, логируется событие. При восстановлении — также фиксируется событие в логах.

Основной цикл обработки файлов
- Непрерывно отслеживаются директории обнаружений, стрельбы и пополнения боезапаса

При появлении нового файла
- Проверяется целостность содержимого через сравнение контрольных сумм.
- Расшифровывается сообщение (base64)
- В зависимости от папки файл обрабатывается
    - detections — записываются данные о новой цели
    - Стрельба (shooting) — фиксируются факты выстрелов и их результаты (попадание/промах)
    - Боекомплект (ammo) — обновляется количество боеприпасов для указанного сервиса
- После успешной обработки файл удаляется
- Ведение полного лога всех событий в файл kp.log

spro:
Подготовка
- Импорты: подключаются internal.sh, utils/const.sh, utils/common.sh.
- Проверка параметров: скрипту надо передать три аргумента — X-координату, Y-координату и радиус действия
- Устанавливаются пути к логам и временному файлу уже обработанных целей (spro_processed_files.txt)

Основной цикл работы
- Пополнение боезапаса: Если боезапас обнулен и прошло RELOAD_TIME, то пополнение на 10 ракет. Боезапас пополняется по ttl в zrdn + spro, об этом отправляются на kp события, записываются впоследствии в БД
- Чтобы гарантированно просматривать уникальные цели в пачке - если одна и та же цель встречается дважды в одном обходе завершаем в текущей итерации просмотр дальнейшей пачки целей

Для каждой цели
- Если в цель стреляли в прошлой пачке и встретилась снова — значит промахнулись
- Вычисляется дистанция до цели. Если цель в радиусе и уже была замечена раньше, то вычисляется её скорость (на основе движения между двумя точками)
- Если скорость характерна для ББ БР, стреляем по цели, если есть ракеты, и логируем обнаружение
- Сохраняется время выстрела для отслеживания результата попадания/промаха
- Уменьшается боезапас
- Если цель, по которой стреляли, не встретилась в текущей пачке — значит она уничтожена ранее

Прочее
- process_ping "spro" — для поддержания связи (пинга)
- trim_log_file — обрезка лога, чтобы не разрастался бесконечно
- При получении сигналов SIGINT или SIGTERM вызывается функция defer, которая останавливает СПРО
- Шифруются и сохраняются события (encrypt_and_save_message)

zrdn:
Алгоритм аналогичен spro, отличия:
Боезапас	10 -> 20
Перезарядка	20 секунд -> 10 секунд
Цели для атаки	только "ББ БР" -> "Крылатая ракета" и "Самолет"
В логах	разные формулировки

rls:
Алгоритм очень схож с spro/zrdn, только в нем нет выстрелов по целям
Подготовка
- Импорты: подключаются internal.sh, utils/const.sh, utils/common.sh.
- Скрипт получает 9 аргументов — <Номер_РЛС> <X_координата> <Y_координата> <Радиус действия> <Азимут> <Угол обзора> <СПРО_X_координата> <СПРО_Y_координата> <СПРО Радиус действия>

Основной цикл работы
- Если цель вне радиуса РЛС пропускаем
- Если цель не в секторе РЛС пропускаем
- Если текущая засечка вторая для цели - определяем ее скорость, тип
- Если тип - ББ БР, определяем движется ли она в сторону СПРО и логируем об этом информацию на КП в зашифрованном виде

Прочее
- ответы на пинг запросы в фоне
- обрезка файла логов, чтобы не разрастался бесконечно